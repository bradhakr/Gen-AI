{
  "goid": "238605d46c2bbf614b6aeeac4e551d29",
  "guid": "384cbbed-2659-4b7c-846d-bb624e0618c1",
  "name": "GenAI - Dynamic Policy Adding using Graphman - AddPolicy",
  "resolutionPath": "/rest/genAI/import/addPolicy",
  "serviceType": "WEB_API",
  "checksum": "ca40d7e8d2cec44e0b486ad3db8d42724d0c64ec",
  "enabled": true,
  "folderPath": "/GenAI",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "DELETE"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "json": "{\"All\":[{\"Comment\":\"API :- Layer7 Add Policy using Graphman\"},{\"Comment\":\"************************************************************\"},{\"Comment\":\"API Group :- REST Encryption\"},{\"Comment\":\"API TYPE :- REST\"},{\"Comment\":\"Author: Balaji Radhakrishnan\"},{\"Comment\":\"************************************************************\"},{\"All\":[{\"SetVariable\":{\"expression\":\"{\\r\\n    \\\"Exception\\\": \\\"Request Failed\\\",\\r\\n    \\\"Description\\\": \\\"Unable to execute the request, please contact admin. \\\"\\r\\n}\",\"variable\":\"error\"}},{\"SetVariable\":{\"expression\":\"500\",\"variable\":\"errorCode\"}}]},{\"OneOrMore\":[{\"All\":[{\"All\":[{\"SetVariable\":{\"expression\":\"{\\r\\n    \\\"Exception\\\": \\\"Request Failed\\\",\\r\\n    \\\"Description\\\": \\\"Not a HTTPS request, please upgrade the reuest.\\\"\\r\\n}\",\"variable\":\"error\"}},{\"SetVariable\":{\"expression\":\"426\",\"variable\":\"errorCode\"}}]},{\"Ssl\":{}},{\"All\":[{\"SetVariable\":{\"expression\":\"{\\r\\n    \\\"Exception\\\": \\\"Authentication Failed\\\",\\r\\n    \\\"Description\\\": \\\"Missing or Invalid User Credentials\\\"\\r\\n}\",\"variable\":\"error\"}},{\"SetVariable\":{\"expression\":\"401\",\"variable\":\"errorCode\"}}]},{\"HttpBasic\":{}},{\"Authentication\":{\"identityProviderOid\":\"0000000000000000fffffffffffffffe\"}},{\"All\":[{\"SetVariable\":{\"expression\":\"{\\r\\n    \\\"Exception\\\": \\\"Rate Limit Failed\\\",\\r\\n    \\\"Description\\\": \\\"Rate Limit has been applied, please try few min later.\\\"\\r\\n}\",\"variable\":\"error\"}},{\"SetVariable\":{\"expression\":\"429\",\"variable\":\"errorCode\"}}]},{\"RateLimit\":{\"counterName\":\"PRESET(22294c1c291b31fe)${request.clientid}\",\"maxRequestsPerSecond\":\"10\"}},{\"All\":[{\"SetVariable\":{\"expression\":\"{\\r\\n    \\\"Exception\\\": \\\"Policy Import Failed\\\",\\r\\n    \\\"Description\\\": \\\"Unable to import the policy, please contact admin.\\\"\\r\\n}\",\"variable\":\"error\"}},{\"SetVariable\":{\"expression\":\"400\",\"variable\":\"errorCode\"}}]},{\"All\":[{\"Regex\":{\"autoTarget\":false,\"caseInsensitive\":true,\"regex\":\">\",\"regexName\":\"LineBreak\",\"replace\":true,\"replacement\":\">\\\\\\\\n\"}},{\"Regex\":{\"autoTarget\":false,\"regex\":\"\\\"\",\"regexName\":\"EscapeCharecter\",\"replace\":true,\"replacement\":\"\\\\\\\\\\\"\"}},{\"SetVariable\":{\"contentType\":\"text/xml; charset=utf-8\",\"dataType\":\"message\",\"expression\":\"${request.mainpart}\",\"variable\":\"policyData\"}},{\"SetVariable\":{\"expression\":\"${request.http.header.endpoint}\",\"variable\":\"resolutionPath\"}},{\"SetVariable\":{\"expression\":\"${request.http.header.folder}\",\"variable\":\"folder\"}},{\"SetVariable\":{\"expression\":\"\\\"query\\\": \\\"mutation setWebApiServices (\\\\n    $webApiServices: [WebApiServiceInput!]!,\\\\n    $clusterProperties: [ClusterPropertyInput!]!) {\\\\n    # Ensure the availability of Web API service dependencies\\\\n    setClusterProperties(input: $clusterProperties) {\\\\n        detailedStatus {status description}\\\\n        clusterProperties {\\\\n            goid\\\\n            name\\\\n            checksum\\\\n        }\\\\n    }\\\\n    setWebApiServices (input: $webApiServices) {\\\\n        detailedStatus {status description}\\\\n        webApiServices {\\\\n            goid\\\\n            name\\\\n            resolutionPath\\\\n            checksum\\\\n        }\\\\n    }\\\\n}\\\"\",\"variable\":\"query\"}},{\"SetVariable\":{\"expression\":\"\\\"variables\\\": {\\r\\n        \\\"webApiServices\\\": [\\r\\n            {\\r\\n                \\\"name\\\": \\\"GenAI - WebView\\\",\\r\\n                \\\"resolutionPath\\\": \\\"${resolutionPath}\\\",\\r\\n                \\\"enabled\\\": true,\\r\\n                \\\"folderPath\\\": \\\"${folder}\\\",\\r\\n                \\\"methodsAllowed\\\": [\\r\\n                    \\\"GET\\\",\\r\\n                    \\\"POST\\\",\\r\\n                    \\\"PUT\\\",\\r\\n                    \\\"DELETE\\\",\\r\\n                    \\\"OPTIONS\\\"\\r\\n                ],\\r\\n                \\\"tracingEnabled\\\": false,\\r\\n                \\\"wssProcessingEnabled\\\": false,\\r\\n                \\\"policy\\\": {\\r\\n                    \\\"xml\\\": \\\"${policyData.mainpart}\\\"\\r\\n                }\\r\\n            }\\r\\n        ],\\r\\n        \\\"clusterProperties\\\": [ ]\\r\\n    }\",\"variable\":\"queryVariables\"}},{\"SetVariable\":{\"contentType\":\"application/json; charset=utf-8\",\"dataType\":\"message\",\"expression\":\"{\\r\\n    ${query},\\r\\n    ${queryVariables}   \\r\\n}\",\"variable\":\"ReqPayload\"}},{\"GatewayGraphQL\":{\"otherTargetMessageVariable\":\"reqPayload\",\"target\":\"OTHER\"}},{\"HardcodedResponse\":{\"body\":\"${reqPayload.mainpart}\",\"contentType\":\"application/json; charset=UTF-8\"},\".properties\":{\".enabled\":false}},{\"HardcodedResponse\":{\"body\":\"${response.mainpart}\",\"contentType\":\"application/json; charset=UTF-8\"}}]}]},{\"All\":[{\"CustomizeErrorResponse\":{\"content\":\"${error}\",\"contentType\":\"application/json; charset=UTF-8\",\"extraHeaders\":[{\".type\":\"nameValuePair\",\"key\":\"APIM-ERR-CODE\",\"value\":\"${errorCode}\"}],\"httpStatus\":\"${errorCode}\",\"includePolicyDownloadURL\":true}},{\"RaiseError\":{}}]}]}]}"
  }
}